(function(a){function cI(c){if(!c||!c.denied||!a.isFunction(c.denied))return cb(this,g.InvalidArguments,"showUserAuthorization: wrong arguments");document.hidden&&!c.force?(be("showUserAuthorization deferred with visibilityState: "+document.visibilityState),bg(document,"visibilitychange",function d(){document.hidden||(be("showUserAuthorization detected visibilitychange from hidden to "+document.visibilityState),cI(c),bh(document,"visibilitychange",d))})):bk("showUserAuthorization",function(){b.deniedCb=c.denied,b.userAuthStatus="UserAuthPending"})}function cH(){var a=bo();if(!a.capabilities.delayedUserAuth){cb(this,g.OperationNotSupported,'Check cwic("about").capabilities.delayedUserAuth');return"Unknown"}return b.userAuthStatus}function cG(){be(!1,"Undocking ...");var a=this;cE.hasDockingCapabilities()&&cE.isDocked?(be(!0,"undock",arguments),cE.resetPosition(),be(!0,"Setting isDocked to false"),cE.isDocked=!1,bk("undockExternalWindow")):cE.hasDockingCapabilities()||cb(a,g.DockingCapabilitiesNotAvailable);return a}function cF(a){var b=this,c=a?a.window:window,d=a?a.element:b[0];cE._about=bo(),cE.hasDockingCapabilities()&&d instanceof c.HTMLElement?(cE.isDocked=!0,be(!0,"dock",arguments),cE.resetPosition(),cE.frame=c,cE.element=d,cE.sendMessageToAddOn("dockExternalWindow",cE.updateOffsets(cE.element.getBoundingClientRect())),cE.frame.requestAnimationFrame(cE.move)):cE.hasDockingCapabilities()?d instanceof c.HTMLElement||cb(b,g.DockArgumentNotHTMLElement):cb(b,g.DockingCapabilitiesNotAvailable);return b}function cD(){bb?(be(!0,"setExternalWindowTitle"),typeof arguments[0]=="string"&&bk("setExternalWindowTitle",{title:arguments[0]})):be(!1,"returning from setExternalWindowTitle ... not supported in the current state")}function cC(a){bb?(be(!0,"setExternalWindowSelfViewPipPosition"),cB(a)):be(!1,"returning from setExternalWindowShowControls ... not supported in the current state")}function cB(a){if(!p(a))be(!1,"setExternalWindowSelfViewPipPosition expects object as an argument");else{var b=parseInt(a.topLeftX,10),c=parseInt(a.topLeftY,10),d=parseInt(a.bottomRightX,10),e=parseInt(a.bottomRightY,10);if(!r(b)||!r(c)||!r(d)||!r(e)){be(!1,"setExternalWindowSelfViewPipPosition invalid arguments ... expecting numbers from 0 to 100");return}bk("setExternalWindowSelfViewPipPosition",{pipLeft:b,pipTop:c,pipRight:d,pipBottom:e})}}function cA(a){bb?(be(!0,"setExternalWindowShowControls"),typeof a=="boolean"&&bk("setExternalWindowShowControls",{showControls:a})):be(!1,"returning from setExternalWindowShowControls ... not supported in the current state")}function cz(){bb?(be(!0,"setExternalWindowShowSelfViewPip"),typeof arguments[0]=="boolean"&&bk("setExternalWindowShowSelfViewPip",{showSelfViewPip:arguments[0]})):be(!1,"returning from setExternalWindowShowSelfViewPip ... not supported in the current state")}function cy(){bb?(be(!0,"setExternalWindowAlwaysOnTop"),typeof arguments[0]=="boolean"&&bk("setExternalWindowAlwaysOnTop",{alwaysOnTop:arguments[0]})):be(!1,"returning from setExternalWindowAlwaysOnTop ... not supported in the current state")}function cx(){bb?(be(!0,"hideExternalWindow"),cE.isVideoBeingReceived=!1,bk("hideExternalWindow")):be(!1,"returning from hideExternalWindow ... not supported in the current state")}function cw(){bb?(be(!0,"getExternalWindowState"),bk("getExternalWindowState")):be(!1,"returning from getExternalWindowState ... not supported in the current state")}function cv(){bb?(be(!0,"showPreviewInExternalWindow"),cE.isVideoBeingReceived=!0,bk("showPreviewInExternalWindow")):be(!1,"returning from showPreviewInExternalWindow ... not supported in the current state")}function cu(){be(!0,"showCallInExternalWindow");var a=this,b=a.data("cwic"),c=b?b.id:null;arguments.length>0&&(typeof arguments[0]=="object"?(b=arguments[0],c=b.id):typeof arguments[0]=="string"&&(c=arguments[0]));if(!c)return cb(a,g.InvalidArguments,"wrong arguments (showCallInExternalWindow)",arguments);cE.isVideoBeingReceived=!0,bk("showCallInExternalWindow",{callId:c})}function ct(){be(!0,"setCaptureDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cb(a,g.InvalidArguments,"wrong arguments (setCaptureDevice)",arguments);bk("setCaptureDevice",{clientCaptureID:b}),bk("getMultimediaDevices",function(b){bP(a,b)})}function cs(){be(!0,"setPlayoutDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cb(a,g.InvalidArguments,"wrong arguments (setPlayoutDevice)",arguments);bk("setPlayoutDevice",{clientPlayoutID:b}),bk("getMultimediaDevices",function(b){bP(a,b)})}function cr(a,b){s()?be(!1,"getMultimediaDeviceVolume works only on Windows platform for now..."):(a!=="Speaker"&&a!=="Microphone"&&a!=="Ringer"&&be(!1,'getMultimediaDeviceVolume received wrong "device" parameter. Must be one of ("Speaker", "Microphone", "Ringer") and received: '+a),bb?bk("getMultimediaDeviceVolume",{device:a},b):be(!0,"getMultimediaDeviceVolume: Mutimedia services not started, returning..."))}function cq(){s()?be(!1,"setPlayRingerOnAllDevices works only on Windows platform for now..."):bk("setPlayRingerOnAllDevices")}function cp(a){s()?be(!1,"setRingtone works only on Windows platform for now..."):bk("setCurrentRingtone",{ringtone:a})}function co(b){if(s())be(!1,"setMicrophoneVolume works only on Windows platform for now...");else{var c=parseInt(b.microphoneVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bk("setCurrentMicrophoneVolume",{volume:c},d,e)}}function cn(b){if(s())be(!1,"setRingerVolume works only on Windows platform for now...");else{var c=parseInt(b.ringerVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bk("setCurrentRingerVolume",{volume:c},d,e)}}function cm(b){if(s())be(!1,"setPlayRingerOnAllDevices works only on Windows platform for now...");else{var c=parseInt(b.speakerVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bk("setCurrentSpeakerVolume",{volume:c},d,e)}}function cl(){be(!0,"setRingerDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cb(a,g.InvalidArguments,"wrong arguments (setRingerDevice)",arguments);bk("setRingerDevice",{clientRingerID:b}),bk("getMultimediaDevices",function(b){bP(a,b)})}function ck(){be(!0,"setRecordingDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cb(a,g.InvalidArguments,"wrong arguments (setRecordingDevice)",arguments);bk("setRecordingDevice",{clientRecordingID:b}),bk("getMultimediaDevices",function(b){bP(a,b)})}function cj(b,c){var d=a.Event("ringtonesListAvailable.cwic");d.ringtones=c.ringtones,b.trigger(d)}function ci(a){s()||bk("getAvailableRingtones",function(b){cj(a,b)})}function ch(){var a={multimediadevices:b.multimediadevices};be(!0,"getMultimediaDevices returning:",a);return a}function cg(){be(!0,"getInstanceId");return b.instanceId}function cf(){be(!0,"sendDTMF");var a=this,b=null,c=a.data("cwic"),d=c?c.id:null,e=["1","2","3","4","5","6","7","8","9","0","#","*","A","B","C","D","a","b","c","d"];arguments.length>0&&(b=typeof arguments[0]=="string"?arguments[0]:null,arguments.length>1&&(typeof arguments[1]=="object"?(c=arguments[1],d=c.id):typeof arguments[1]=="string"&&(d=arguments[1])));if(typeof b!="string"||!d)return cb(a,g.InvalidArguments,"wrong arguments (sendDTMF)",arguments);if(e.indexOf(b)===-1)return cb(a,g.InvalidArguments,"invalid DTMF digit (sendDTMF)",arguments);bk("sendDTMF",{callId:d,digit:b});return a}function ce(){be(!0,"updateConversation",arguments);var b=this;if(b.length===0)return b;var c=arguments[0],d=null,e=null;typeof arguments[1]=="object"?(d=arguments[1],e=d.id):typeof arguments[1]=="undefined"?(d=b.data("cwic"),typeof d=="object"&&(e=d.id)):(e=arguments[1],d=a(".cwic-conversation-"+e).data("cwic")||b.data("cwic"));if(!e||!d)return cb(b,g.InvalidArguments,"cannot update conversation: undefined or empty conversation id");if(typeof c=="string"){var f=null,h=null;if(c.match(/^hold$/i))f="hold",h={callId:e};else if(c.match(/^resume$/i))f="resume",h={callId:e};else if(c.match(/^mute$/i))f="mute",h={callId:e};else if(c.match(/^unmute$/i))f="unmute",h={callId:e};else if(c.match(/^muteAudio$/i))f="mute",h={callId:e,muteAudio:!0};else if(c.match(/^muteVideo$/i))f="mute",h={callId:e,muteVideo:!0};else if(c.match(/^unmuteAudio$/i))f="unmute",h={callId:e,unmuteAudio:!0};else if(c.match(/^unmuteVideo$/i))f="unmute",h={callId:e,unmuteVideo:!0};else return cb(b,g.InvalidArguments,"wrong arguments (update conversation) - "+c,arguments);bk(f,h,a.noop,function(a){cb(b,i(a),a)})}else if(typeof c=="object"){var k=!1;if(c.transferCall){if(x.inProgress){be(!0,"Call transfer already in progress, canceling...");return b}k=!0,x.completeBtn=c.completeButton,x.inProgress=!0,bk("transferCall",{callId:e,transferToNumber:c.transferCall},a.noop,function(a){cb(b,i(a,"NativePluginError"),"transferCall",a)})}c.joinCall&&(k=!0,bk("joinCalls",{joinCallId:e,callId:c.joinCall},a.noop,function(a){cb(b,i(a,"NativePluginError"),"joinCall",a)})),c.videoDirection&&(k=!0,bk("setVideoDirection",{callId:e,videoDirection:c.videoDirection},a.noop,function(a){cb(b,i(a,"NativePluginError"),"videoDirection",a)})),c.addRemoteVideoWindow&&(k=!0,be("updateConversation() calling addWindowToCall() for conversationId: "+e),bL({callId:e,remoteVideoWindow:c.addRemoteVideoWindow,window:c.window})),c.removeRemoteVideoWindow&&(k=!0,be("updateConversation() calling removeWindowFromCall() for conversationId: "+e),bM({callId:e,remoteVideoWindow:c.removeRemoteVideoWindow,window:c.window,endCall:!1})),k||cb(b,g.InvalidArguments,"wrong arguments (update conversation)",arguments)}else cb(b,g.InvalidArguments,"wrong arguments (update conversation)",arguments);return b}function cd(){be(!0,"endConversation",arguments);var b=this;if(b.length===0)return b;var c=null,d=null,e=null;if(arguments.length===0){d=b.data("cwic");if(!d)return cb(b,"cannot end conversation: no conversation exists for this element");e=d.id}else arguments.length===1?(c=typeof arguments[0]=="boolean"?arguments[0]:null,d=typeof arguments[0]=="object"?arguments[0]:b.data("cwic"),e=typeof arguments[0]=="string"?arguments[0]:d.id):arguments.length===2&&(c=typeof arguments[0]=="boolean"?arguments[0]:null,d=typeof arguments[1]=="object"?arguments[1]:b.data("cwic"),e=typeof arguments[1]=="string"?arguments[1]:d.id);if(!e)return cb(b,g.InvalidArguments,"cannot end conversation: undefined or empty conversation id");x.callId===e&&x.endTransfer();if(c){d=d||a(".cwic-conversation-"+e).data("cwic");if(!d)return cb(b,"cannot iDivert - undefined conversation");if(!d.capabilities||!d.capabilities.canImmediateDivert)return cb(b,g.MissingCapability,"cannot iDivert - missing capability",{conversation:d});be(!0,"iDivert conversation",d),bk("iDivert",{callId:e})}else be(!0,"end conversation",d),w.endingCallForId=e,bk("endCall",{callId:e});return b}function cc(){be(!0,"startConversation",arguments);var b=this,c=arguments[0]||b.data("cwic")||{},d,e;if(b.length===0)return cb(b,c.error,g.InvalidArguments,"cannot start conversation with empty selection");var f=b;typeof c.container=="string"?f=a(c.container):typeof c.container=="object"&&(f=c.container),f=f.first();if(typeof c.id!="undefined"){f.addClass("cwic-data cwic-conversation cwic-conversation-"+c.id).data("cwic",c),arguments.length>=1?(e=c.videoDirection,c.remoteVideoWindow&&(bL({callId:c.id,remoteVideoWindow:c.remoteVideoWindow}),c.remoteVideoWindow.windowhandle&&(d=c.remoteVideoWindow.windowhandle))):e="";var h={callId:c.id,videoDirection:e};d&&(h.windowhandle=d),bk("answer",h)}else{var j=c.participant||{};typeof j=="string"&&(j={recipient:j});if(typeof j.recipient=="undefined")return cb(b,c.error,g.InvalidArguments,"cannot start conversation: undefined or empty recipient");f.addClass("cwic-data cwic-conversation cwic-conversation-outgoing").data("cwic",{participant:j}),f.is(":hidden")&&be(!0,"startConversation - warning: container is hidden");var k={recipient:j.recipient,videoDirection:c.videoDirection};c.remoteVideoWindow&&c.remoteVideoWindow.windowhandle&&(k.windowhandle=c.remoteVideoWindow.windowhandle),bk("originate",k,function(a){a.callId&&a.callId>=1&&c.remoteVideoWindow&&(c.window=c.window||window,bL({callId:a.callId,remoteVideoWindow:c.remoteVideoWindow,window:c.window}))},function(a){a&&(be(!0,"originate error",a),cb(b,i(a),a,"cannot start conversation"))})}return b}function cb(){var b=arguments[0],c=null,d=a.extend({details:[]},g.Unknown);for(var e=1;e<arguments.length;e++){var f=arguments[e];a.isFunction(f)?c=f:typeof f=="string"?d.details.push(f):typeof f=="object"&&a.extend(d,f)}be(d.message,d);if(c)try{c(d)}catch(h){be("Exception occurred in application error callback",h),typeof console!="undefined"&&console.trace&&console.trace()}else{var i=a.Event("error.cwic");a.extend(i,d),b.trigger(i)}return b}function ca(b,c,e){var f=c.callId,g=c.callState;if(f!==w.endingCallForId||g!=="Connected"){x.inProgress&&(c.capabilities.canDirectTransfer=!1);var h=c.participants&&c.participants.length>0?c.participants[0]:{},i=h.directoryNumber&&h.directoryNumber!==""?h.directoryNumber:h.number;h=a.extend({},h,{recipient:i});var j=a(".cwic-conversation-"+f);j.length===0&&(j=a(".cwic-conversation-outgoing"));var k=j.data("cwic")||{};be(!0,"conversation id="+f+" state="+c.callState||k.state,c),c=a.extend({},k,c,{id:f,state:g||k.state,participant:a.extend(k.participant,h)});if(c.state==="Ringin"&&j.length===0){j=a("<div>").addClass("cwic-data cwic-conversation cwic-conversation-"+f).data("cwic",c),b.trigger("conversationIncoming.cwic",[c,j]);return}if(c.state==="OnHook"&&!c.capabilities.canOriginateCall||!c.exists){bM({callId:f,remoteVideoWindow:d.videoObject,window:d.window,endCall:!0});if(j.length===0){be("warning: no container for ended conversation "+f),b.trigger("conversationEnd.cwic",[c]);return}j.removeData("cwic").removeClass("cwic-data cwic-conversation cwic-conversation-"+c.id).trigger("conversationEnd.cwic",[c]);return}if(c.state==="OffHook"||c.state==="Connected"){typeof c.connect=="undefined"&&c.state==="Connected"&&(j.length===0&&(j=a("<div>").addClass("cwic-conversation cwic-conversation-"+f)),a.extend(c,{connect:new Date}),j.data("cwic",c));if(typeof c.start=="undefined"){j.length===0&&(j=a("<div>")),a.extend(c,{start:new Date}),j.data("cwic",c),j.removeClass("cwic-conversation-outgoing").addClass("cwic-conversation cwic-conversation-"+f).data("cwic",c),b.trigger("conversationStart.cwic",[c,j]);return}}if(j.length===0){j=a("<div>").data("cwic",c).addClass("cwic-conversation cwic-conversation-"+f),be("warning: no container for updated conversation "+f);if(c.exists){b.trigger("conversationStart.cwic",[c,j]);return}b.trigger("conversationUpdate.cwic",[c,j]);return}j.data("cwic",c),j.trigger("conversationUpdate.cwic",[c,j])}}function b_(){be(!0,"_reset: reseting regGlobals..."),a(".cwic-data").removeData("cwic"),z()}function b$(a){var b;be(!0,"signOut",arguments),p(arguments[0])&&typeof arguments[0].complete=="function"&&(b=arguments[0].complete),bZ({forceLogout:!0,complete:b})}function bZ(){be(!0,"unregisterPhone",arguments);var a=this;cx(),p(arguments[0])&&arguments[0].forceLogout===!0&&(bk("logout"),v={devices:{}});if(p(arguments[0])&&typeof arguments[0].complete=="function"){var b=arguments[0].complete;w.unregisterCb=function(){be(!0,"Calling unregisterCb...");try{b()}catch(a){be("Exception occurred in application unregister complete callback",a),typeof console!="undefined"&&console.trace&&console.trace()}w.unregisterCb=null}}b_();return a}function bY(){return}function bX(c,d){var e=u.get("passphrase"),f={devicesAvailableCb:null,tftp:[],ccmcip:[],cti:[],passphrase:""};f.devicesAvailableCb=a.isFunction(c.devicesAvailable)?c.devicesAvailable:null;if(!b){cb(d,w.errorCb,g.PluginNotAvailable,"Plug-in is not available or has not been initialized",{registration:v});throw new Error("Break manual login")}a.each(a.makeArray(c.cucm),function(b,c){if(typeof c=="string"){var d=c.split(" ").pop();f.tftp.push(d),f.ccmcip.push(d),f.cti.push(d)}else if(typeof c=="object"){var e=[],g=!1;a.isArray(c.tftp)&&(f.tftp=f.tftp.concat(c.tftp),e=c.tftp,g=!0),a.isArray(c.ccmcip)?(f.ccmcip=f.ccmcip.concat(c.ccmcip),g=!0):f.ccmcip=f.ccmcip.concat(e),a.isArray(c.cti)?(f.cti=f.cti.concat(c.cti),g=!0):f.cti=f.cti.concat(e),g||(be("registerPhone: no ccmcip/tftp/cti properties for cucm element"),be(!0,c))}else be("registerPhone: ignoring cucm argument of type "+typeof c)}),be("registerPhone: "+f.tftp.length+" cucm TFTP address(es)"),be(!0,f.tftp),be("registerPhone: "+f.ccmcip.length+" cucm CCMCIP address(es)"),be(!0,f.ccmcip),be("registerPhone: "+f.cti.length+" cucm CTI address(es)"),be(!0,f.cti);if(f.tftp.length>3||f.ccmcip.length>3||f.cti.length>3)be("registerPhone: Server address(es) are limited to 3 values. Only first 3 values will be kept."),f.tftp=f.tftp.splice(0,3),f.ccmcip=f.ccmcip.splice(0,3),f.cti=f.cti.splice(0,3);be("registerPhone of user="+v.user+' in mode="'+v.mode+'"');if(!v.user){cb(d,w.errorCb,g.InvalidArguments,"Missing user name",{registration:v});throw new Error("Break manual login")}if(!a.isArray(f.tftp)||f.tftp.length<1){cb(d,w.errorCb,g.NoCallManagerConfigured,"Missing CUCM address",{registration:v});throw new Error("Break manual login")}if(!v.mode.match(/^(SoftPhone|DeskPhone)$/)){cb(d,w.errorCb,g.InvalidArguments,'Invalid phone mode "'+v.mode+'"',{registration:v});throw new Error("Break manual login")}f.passphrase=c.passphrase||c.password;if(typeof f.passphrase=="string"){if(e.isNotValid(f.passphrase)){cb(d,w.errorCb,g.InvalidArguments,"invalid passphrase",{registration:v});throw new Error("Break manual login")}}else{if(typeof f.passphrase!="object"||f.passphrase.cipher!=="cucm"){cb(d,w.errorCb,g.InvalidArguments,"invalid passphrase (type "+typeof f.passphrase+")",{registration:v});throw new Error("Break manual login")}if(e.isNotValid(f.passphrase.encrypted)){cb(d,w.errorCb,g.InvalidArguments,"invalid passphrase",{registration:v});throw new Error("Break manual login")}}return f}function bW(b){w.registeringPhone=!0,w.manual=!0,v={user:b.user,mode:b.mode||"SoftPhone",devices:{},forceRegistration:b.forceRegistration||!1},w.successCb=a.isFunction(b.success)?b.success:null,w.errorCb=a.isFunction(b.error)?b.error:null,w.CUCM=b.cucm,w.user=b.user,be(!0,"setRegGlobalsM: regGlobals set: ",w),be(!0,"setRegGlobalsM: registration set: ",v)}function bV(b){var c=a.extend({},b);c.passphrase&&(c.passphrase="*****"),c.password&&(c.password="*****"),be(!0,"manualSignIn",c)}function bU(c){function p(){var c=b.connectionStatus;c==="eReady"&&bx(d,c),w.passphrase=m;if(c!=="eReady"){w.currState=c,w.authenticatedCallback=D(e,d);if(!m.encrypted||m.cipher!=="cucm")return cb(d,w.errorCb,g.InvalidArguments,"authenticateAndConnect: invalid passphrase (type "+typeof m+")",{registration:v});w.errorState==="credentialsRequired"?I(d,{errors:[],error:"",authenticatorId:w.lastAuthenticatorId}):bk("startSignIn",{manualSettings:!0},a.noop,function(a){cb(d,w.errorCb,i(a),a,{registration:v})})}}function o(a){return function(c){be(!0,a+" callback received"),l[a]=c[a],l.hasOwnProperty("TftpAddressList")&&l.hasOwnProperty("CtiAddressList")&&l.hasOwnProperty("CcmcipAddressList")&&l.hasOwnProperty("connectionStatus")&&(be(!0,"All prop callbacks received.  Continuing toward authenticateAndConnect",l),b.connectionStatus=l.connectionStatus,p())}}function n(a){a&&(m={cipher:"cucm",encrypted:a}),bk("setProperty",{TftpAddressList:f},o("TftpAddressList")),bk("setProperty",{CtiAddressList:j},o("CtiAddressList")),bk("setProperty",{CcmcipAddressList:h},o("CcmcipAddressList")),bk("getProperty","connectionStatus",o("connectionStatus"))}var d=this,e,f=[],h=[],j=[],k,l={},m;bV(c),bW(c);try{k=bX(c,d),e=k.devicesAvailableCb,f=k.tftp,h=k.ccmcip,j=k.cti,m=k.passphrase}catch(q){return d}typeof m=="string"?bk("encryptCucmPassword",m,n):n();return d}function bT(b){function f(c){if(a.isFunction(b.progress))try{b.progress(c)}catch(d){be("Exception occurred in application switchPhoneMode progress callback",d),typeof console!="undefined"&&console.trace&&console.trace()}}function e(e){var g=e.devices||[],h=!0,j,k,l,m,n=d.phoneMode,o=d.deviceName,p=d.lineDN,q=d.forceRegistration;j=a.grep(g,function(a){return a.isDeskPhone&&n==="DeskPhone"||a.isSoftPhone&&n==="SoftPhone"});if(j.length===0){be(!0,"switchPhoneMode: filtered device list is empty!"),a.isFunction(b.error)&&cb(c,b.error,'no device found for mode: "'+n+'"');return c}k=a.map(j,function(a){return a.name}),m=o&&a.inArray(o,k)>-1,o&&m&&(h=!1),m||be(!0,"switchPhoneMode: Device name not set or invalid, proceeding with default device selection"),h?(p="",l=j[0]&&j[0].name):l=o,be(!0,"switchPhoneMode: selected device: ",l),be(!0,"switchPhoneMode: switching to mode: ",n),be(!0,"switchPhoneMode: switching to line: ",p),bk("connect",{phoneMode:n,deviceName:l,lineDN:p,forceRegistration:q},function(){f({message:"Switch mode operation started"})},function(d){a.isFunction(b.error)&&cb(c,b.error,i(d),{message:d})})}var c=this;be(!0,"switchPhoneMode started with arguments: ",b);if(typeof b!="object"){be(!0,"switchPhoneMode: no arguments provided, stoping execution!");return c}w.successCb=a.isFunction(b.success)?b.success:null,w.errorCb=a.isFunction(b.error)?b.error:null,w.switchingMode=!0;var d={phoneMode:b.mode||"SoftPhone",deviceName:b.device||(b.mode==="SoftPhone"?bp({username:v.user}):""),lineDN:b.line||"",forceRegistration:b.forceRegistration||!1};bw(e);return this}function bS(){var a=bR.handlersList,c,d,e,f;if(a)for(e=0,f=a.length;e<f;e+=1)c=a[e].name,d=a[e].handler,typeof c=="string"&&typeof d=="function"&&(be(!0,"removing npapi listener for "+c+" event."),bh(b.api,c,d));else be(!0,'trying to remove npapi listeners, but no "_registerNpapiCallbacks.handlersList" found.')}function bR(){function d(a){var b;try{b=JSON.parse(a)}catch(d){be(!1,"Invalid JSON message from plugin",d);throw new Error(g.NativePluginError.code)}if(b.ciscoChannelMessage&&b.ciscoChannelMessage.ciscoSDKServerMessage){if(b.ciscoChannelMessage.client&&b.ciscoChannelMessage.client.id&&b.ciscoChannelMessage.client.id!==c)return;b=b.ciscoChannelMessage}bi(b)}var a="addonmessage",e=bR.handlersList=[];e.push({name:a,handler:d}),be(!0,"adding npapi listener for "+a),bg(b.api,a,d)}function bQ(b,c){be(!0,"externalWindowEvent",c);var d=a.Event("externalWindowEvent.cwic");d.externalWindowState=c,b.trigger(d)}function bP(c,d){be(!0,"mmDeviceChange",d),d&&(b.multimediadevices=d.multimediadevices);var e=a.Event("mmDeviceChange.cwic");c.trigger(e)}function bO(a,b){var c=b.result,d=b.status;be(!0,"authentication result: "+c),be(!0,"authentication status: "+d),w.lastAuthStatus=d}function bN(a){var c=this;be(!0,"shutdown",arguments),l(),a||b$(),W(),c.unbind(".cwic"),bS(),bk("releaseInstance"),bl.purge(),b=null}function bM(a){var b=this,c=a.endCall,e=bo();if(e.capabilities.videoPluginObject===!1)be(!1,"removeWindowFromCall called from unsupported browser");else{if(d.lastId!==a.callId){be("cannot call removeWindowFromCall for callId "+a.callId+". Last call id was: "+d.lastId);return}be(!0,"removeWindowFromCall() called with arguments: ",a),be(!0,"removeWindowFromCall(): activeConversation object: ",d),a.methodName=c?"stopRemoteVideo":"removeWindowFromCall",be(!0,"removeWindowFromCall() calling method "+a.methodName),a.videoObject=a.remoteVideoWindow,bI(a);return b}}function bL(b){var c=this,e=b.success,f=!1,g=bo();if(g.capabilities.videoPluginObject===!1)be(!1,"addWindowToCall called from unsupported browser");else{d.lastId!==b.callId&&(f=!0),be(!0,"addWindowToCall() called with arguments: ",b),be(!0,"addWindowToCall(): activeConversation object: ",d),b.methodName=f?"startRemoteVideo":"addWindowToCall",be(!0,"addWindowToCall() calling "+b.methodName),b.videoObject=b.remoteVideoWindow,b.success=function(c){f&&(be(!0,"addWindowToCall(): setting activeConversation object"),d.videoObject=c,d.window=b.window,d.lastId=b.callId),a.isFunction(e)&&e()},bI(b);return c}}function bK(a){var b=this,c=bo();if(c.capabilities.videoPluginObject===!1)be(!1,"removePreviewWindow called from unsupported browser");else{a.methodName="removePreviewWindow",a.videoObject=a.previewWindow,bI(a);return b}}function bJ(a){var b=this,c=bo();if(c.capabilities.videoPluginObject===!1)be(!1,"addPreviewWindow called from unsupported browser");else{a.methodName="addPreviewWindow",a.videoObject=a.previewWindow,bI(a);return b}}function bI(a){be(!0,"execVideoObjectOperation called with arguments",a);var b=a.window||window,c=a.videoObject,d=a.methodName;if(typeof c=="string")try{c=b.document.getElementById(c)}catch(e){be(!0,"execVideoObjectOperation: invalid window object"),a.error&&a.error(i("InvalidArguments"));return}bt({obj:c,methodName:d,error:a.error||null,success:a.success||null,callId:a.callId||null})}function bH(b){var c=this,d=bo();if(d.capabilities.video&&d.capabilities.videoPluginObject){b=b||{},b.window=b.window||window;var e="application/x-cisco-cwc-videocall",f=b.onload||"_cwic_onVideoPluginLoaded",g=b.success,h=b.id||"_cwic_vw"+bG;bG++;var i=bq.getWindowId({window:b.window});bq.callbacks[i][h]={callback:g,wascalled:!1};var j='<object type="'+e+'" id="'+h+'"><param name="loadid" value="'+h+'"></param><param name="onload" value="'+f+'"></param></object>';a(c).append(j)}return c}function bF(b){var c=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(c===!0){var d={cwicExtId:"ppbllmlcmhfnfflbkbinnhacecaankdh",verbose:j.verbose},e=function(a){var c=document.createElement("script");c.id=a.cwicExtId,c.onload=function(){cwic_plugin.init(bi,a)},c.onerror=function(){cb(b,j.error,g.ExtensionNotAvailable,"Chrome requires Cisco Web Communicator extension")},c.src="chrome-extension://"+c.id+"/cwic_plugin.js";return c};if(typeof cwic_plugin=="undefined"){var f=e(d);f.onerror=function(){try{document.head.removeChild(document.getElementById(d.cwicExtId))}catch(a){}be("Failed loading release version of Chrome extension.  Attempting to load dev version next."),d.cwicExtId="kekllijkldgcokjdjphahkijinjhlapf",f=e(d),document.head.appendChild(f)},document.head.appendChild(f)}else be(!0,"calling init on previously loaded cwic_plugin script"),d.cwicExtId=cwic_plugin.about().cwicExtId,cwic_plugin.init(bi,d)}else{var h=!1,k=navigator.mimeTypes["application/x-ciscowebcommunicator"];if("ActiveXObject"in window)try{var l=new ActiveXObject("CiscoSystems.CWCVideoCall");h=!0}catch(m){be(!0,'ActiveXObject("CiscoSystems.CWCVideoCall") exception: '+m.message);try{var n=new ActiveXObject("ActivexPlugin.WebPhonePlugin.1");throw i("ReleaseMismatch")}catch(o){be(!0,'ActiveXObject("ActivexPlugin.WebPhonePlugin.1") exception: '+o.message);throw i("PluginNotAvailable")}}else if(typeof k!="undefined")h=!0;else{k=navigator.mimeTypes["application/x-ciscowebphone"];if(typeof k!="undefined")throw i("ReleaseMismatch")}if(h)a(document.body).append('<object id="cwc-plugin" width="1" height="1" type="application/x-ciscowebcommunicator"><param name="onload" value="_cwic_onFBPluginLoaded"></param></object>');else throw i("PluginNotAvailable")}}function bE(a){if(b===null)try{bF(a)}catch(c){b=null,cb(a,j.error,c)}}function bD(b){a(document.body).ready(function(){bE(b)})}function bC(c){window._cwic_userAuthHandler=function(a){b.userAuthStatus=a?"UserAuthorized":"UserDenied",be("_cwic_userAuthHandler result: "+b.userAuthStatus),a===!0?bk("getProperty","connectionStatus",function(a){b.connectionStatus=a.connectionStatus,by(c)}):(cb(c,j.error,"Cannot Initialize Cisco Web Communicator",g.NotUserAuthorized),b.deniedCb&&(b.deniedCb(),b.deniedCb=null))},window._cwic_onInitReceived=function(d){var e;if(typeof cwic_plugin!="undefined"&&b!==null)be("plugin is already loaded.");else{try{typeof cwic_plugin!="undefined"&&(b={},b.scope=c,b.api=cwic_plugin);if(b.api)b.instanceId=d.instanceId,b.version=d.version,b.userAuthStatus=d.userauthstatus,b.capabilities=d.capabilities;else throw i("PluginNotAvailable");be("initialized "+b.userAuthStatus+" plugin",b.version);var f=bo();if(f.upgrade.plugin==="mandatory"){cb(c,j.error,g.PluginNotAvailable,'Cisco Web Communicator cannot be used when plugin upgrade is "mandatory"');return}a(window).unload(function(){bN.call(c,!0)}),b.userAuthStatus==="MustShowAuth"?a.isFunction(j.delayedUserAuth)?j.delayedUserAuth():cI({denied:a.noop}):b.userAuthStatus==="UserAuthorized"&&_cwic_userAuthHandler(!0);return}catch(h){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&h.message&&console.log("Exception occured in _cwic_onInitReceived() "+h.message)),b=null,e=a.extend({},g.PluginNotAvailable,h)}return cb(c,j.error,"Cannot Initialize Cisco Web Communicator",e)}},window._cwic_onFBPluginLoaded=function(){var d;if(b!==null)be("plugin is already loaded.");else{try{b={},b.scope=c;var e=document.getElementById("cwc-plugin");if(e)b.api=e,bR(),bk("init");else throw i("PluginNotAvailable");return}catch(f){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&f.message&&console.log("Exception occured in _cwic_onFBPluginLoaded() "+f.message)),b=null,d=a.extend({},g.PluginNotAvailable,f)}return cb(c,j.error,"Cannot Initialize Cisco Web Communicator",d)}}}function bB(a){var b={result:!0,reason:[]};if(j.serviceDiscovery){typeof a.credentialsRequired!="function"&&(b.reason.push("No credentialRequired callback provided"),b.result=!1),typeof a.emailRequired!="function"&&(b.reason.push("No emailRequired callback provided"),b.result=!1);if(!a.redirectUri||typeof a.redirectUri!="string")b.reason.push("No redirectUri parameter provided"),b.result=!1}return b}function bA(b){typeof b.errorMap!="undefined"&&a.each(b.errorMap,function(b,c){typeof c=="string"?g[b]=a.extend({},g[b],{message:c}):typeof c=="object"?g[b]=a.extend({},g[b],c):be("ignoring invalid custom error [key="+b+"]",c)}),a.extend(j,b)}function bz(a){var b=this,c;be("init",arguments),bA(a),c=bB(a);if(!c.result)return cb(b,j.error,g.InvalidArguments,c.reason.join(", "));bC(b),bD(b);return b}function by(c){var d;try{var e={},f=!1,h=b.connectionStatus;h==="eReady"&&(f=!0);var i=function(b){if(a.isFunction(j.ready))try{j.ready(e,f,b.mode)}catch(c){be("Exception occurred in application ready callback",c),typeof console!="undefined"&&console.trace&&console.trace()}};bk("getProperty","mode",i);if(f){var k=function(b){a.each(a.makeArray(b.calls),function(a,b){ca(c,b,"state")})};bk("getCalls",k)}else bx(c,h);return}catch(l){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&l.message&&console.log("Exception occured in _cwic_onPluginReady() "+l.message)),b=null,d=a.extend({},g.PluginNotAvailable,l),cb(c,j.error,"Cannot Initialize Cisco Web Communicator",d)}}function bx(c,d){be(!0,"providerState "+d);var e=a.Event("system.cwic");e.phone={status:d,ready:!1};var f=function(){e.phone.registration=v,b.connectionStatus=d;if(d==="eReady"){if(w.registeringPhone||w.switchingMode){w.registeringPhone=!1,w.switchingMode=!1;if(w.successCb){var f=a.extend({},v,{cucm:a.makeArray(w.CUCM),password:w.passphrase,passphrase:w.passphrase,mode:null}),g=function(b){be(!0,"getPropsCb res: "+JSON.stringify(b)),a.extend(f,{mode:b.mode});try{w.successCb(f)}catch(c){be("Exception occurred in application success callback",c),typeof console!="undefined"&&console.trace&&console.trace()}};bk("getProperty","mode",g)}else be("warning: no registerPhone success callback")}e.phone.ready=!0,c.trigger(e);var h=function(b){a.each(a.makeArray(b.calls),function(a,b){ca(c,b,"state")})};bk("getCalls",h)}else d==="eIdle"?(typeof w.unregisterCb=="function"&&w.unregisterCb(),c.trigger(e)):c.trigger(e)};bv(d,f)}function bw(a){bk("getAvailableDevices",a)}function bv(b,c){function e(e){var f;e.devices&&(d.devices=e.devices),e.device&&(d.device=e.device,v.device=a.extend({},e.device)),e.line&&(d.line=e.line,v.line=a.extend(v.line,e.line));if(b==="eIdle"&&d.devices||d.devices&&d.device&&d.line)f=a.makeArray(d.devices),a.each(f,function(b,c){if(c.name){var d=a.trim(c.name);v.devices[d]=a.extend({},v.devices[d],c)}}),a.isFunction(c)&&c(f)}var d={};b!=="eIdle"&&(bk("getProperty","device",e),bk("getProperty","line",e)),bw(e)}function bt(a){var b=a.obj,c=a.methodName,d=a.success,e=a.error,f;f=bs(a.callId),!b||typeof b[c]!="function"&&typeof b[c]!="object"?(be(!0,'calling "'+c+'" method on video object failed!'),e&&e(i("InvalidArguments"))):(be(!0,'preparing to call "'+c+'" method on video object, with parameters',f),b[c].apply(this,f),d&&d(b))}function bs(a){var b=c||bj(),d=bj(),e=window.location.href,f=window.location.hostname,g=window.document.title,h,i;h=[d,b,e,f,g];if(a){try{i=parseInt(a,10)}catch(j){be(!0,"generateMessageParamsForIBVideo: invalid callId received..."),i=-1}h.unshift(i)}return h}function bp(b){if(!a.isFunction(j.predictDevice))return b.username?j.devicePrefix+b.username:"";try{return j.predictDevice(b)}catch(c){be("Exception occurred in application predictDevice callback",c),typeof console!="undefined"&&console.trace&&console.trace()}}function bo(){be(!0,"about",arguments);var c={javascript:{version:"11.0.0.675",system_release:"Cisco Unified Communications System Release 11.0"},jquery:{version:a.fn.jquery},channel:null,plugin:null,states:{system:"unknown",device:{exists:!1,inService:!1,lineDNs:[],modelDescription:"",name:""}},capabilities:{},upgrade:{}},d=c.javascript.version.match(/(\d+)\.(\d+)\.(\d+)\.(\d+)/);d&&(c.javascript.release=d[1],c.javascript.major=d[2],c.javascript.minor=d[3],c.javascript.revision=d[4]),typeof cwic_plugin!="undefined"&&(c.channel=cwic_plugin.about());if(b&&b.version)c.plugin={version:b.version};else{var e=bn();e===0?c.upgrade.plugin="mandatory":e&&(c.plugin={version:{plugin:e}})}c.plugin?(d=c.plugin.version.plugin.match(/(\d+)\.(\d+)\.(\d+)\.(\d+)/),d&&(c.plugin.release=d[1],c.plugin.major=d[2],c.plugin.minor=d[3],c.plugin.revision=d[4]),c.javascript.release>c.plugin.release?c.upgrade.plugin="mandatory":c.javascript.release<c.plugin.release?c.upgrade.javascript="mandatory":c.javascript.release===c.plugin.release&&(c.javascript.major>c.plugin.major?c.upgrade.plugin="mandatory":c.javascript.major<c.plugin.major?c.upgrade.javascript="recommended":c.javascript.major===c.plugin.major&&(c.javascript.minor>c.plugin.minor?c.upgrade.plugin="recommended":c.javascript.minor<c.plugin.minor&&(c.upgrade.javascript="recommended")))):c.upgrade.plugin="unknown",b&&(c.states.system=b.connectionStatus||c.states.system,c.states.device=v.device||c.states.device,c.capabilities=b.capabilities||c.capabilities);return c}function bn(){var a=/(\d+\.\d+\.\d+\.\d+)/,b,c=null,d=navigator.mimeTypes["application/x-ciscowebcommunicator"],e=d?d.enabledPlugin:undefined;e&&(c=0,e.version?c=e.version:(b=a.exec(e.description),b&&b[0]&&(c=b[0])));return c}function bm(a){var b=bf();b||(be("Plugin does not exist. Restarting...."),a());return b}function bk(){if(!b||!b.api){be("_sendClientRequest no plugin available");return!1}var d=arguments[0],e=null,f=null,g=b.scope||this;a.isFunction(arguments[1])?f=arguments[1]:e=arguments[1];var h=function(a){cb(g,i(a),{nativeError:a,nativeRequest:d,nativeArgs:e},"unexpected error reply from native plugin")};a.isFunction(arguments[2])&&(f===null?f=arguments[2]:h=arguments[2]),a.isFunction(arguments[3])&&(h=arguments[3]),f=f||a.noop;var j=d==="encryptCucmPassword"?"*****":e;be(!0,"_sendClientRequest: "+d,{successCb:f,errorCb:h,content:j});var k=d==="init"?0:bj(),l={ciscoSDKClientMessage:{messageId:k,name:d,content:e===null?undefined:e}},m=a.extend({},l.ciscoSDKClientMessage);m.content=j,be(!0,"send ciscoSDKClientMessage: "+d,m);if(b.api.sendRequest)b.api.sendRequest(l);else if(b.api.postMessage){c=c||bj();var n={id:c,url:window.location.href,hostname:window.location.hostname,name:window.document.title},o={ciscoChannelMessage:a.extend(l,{client:n})};b.api.postMessage(JSON.stringify(o))}bl.callbacks[k]={successCb:f,errorCb:h}}function bj(){return(new Date).valueOf().toString()+Math.floor(Math.random()*1e4+1).toString()}function be(){var b=typeof arguments[0]=="boolean"?arguments[0]:!1,c=typeof arguments[0]=="string"?arguments[0]:arguments[1],d=typeof arguments[1]=="object"?arguments[1]:arguments[2];if((!b||b&&j.verbose)&&a.isFunction(j.log))try{var e=new Date,f=e.getDate()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"."+("00"+e.getMilliseconds()).slice(-3)+" ";j.log("[cwic] "+f+c,d)}catch(g){}}function bd(b,c){bb=c;var d=a.Event("multimediaCapabilities.cwic");d.multimediaCapability=c,b.trigger(d),c&&(ci(b),bk("getMultimediaDevices",function(a){bP(b,a)}))}function bc(b,c){var d=a.Event("ringtoneChange.cwic");d.currentRingtone=c.ringtone,b.trigger(d)}function ba(b,c){function g(a){return function(b){a(),f&&_(f).unbind()}}var d=a.Event("callTransferInProgress.cwic"),e=c.callId,f=x.completeBtn;x.callId=e,d.completeTransfer=m(Z,e);if(!e)be("_triggerAttendedTransferStateChange: No callId received from the plugin. Returning from the function...");else{be(!0,"_triggerAttendedTransferStateChange: Received callId: "+e),typeof f=="string"&&(f=a("#"+f));if(f&&typeof f.one=="function"&&f.attr){$(f).unbind().one("click",g(d.completeTransfer));return}b.trigger(d);return}}function _(a){if(!(a instanceof jQuery))throw new TypeError("disable function accepts only jQuery objects");a.attr("disabled",!0);return a}function $(a){if(!(a instanceof jQuery))throw new TypeError("enable function accepts only jQuerys");a.attr("disabled",!1);return a}function Z(b){var c=this;if(x.inProgress){bk("completeTransfer",{callId:b},a.noop,function(a){cb(c,i(a,"NativePluginError"),"completeTransfer",a)}),x.endTransfer();return!0}be(!0,"completeTransfer: transfer not in progress, returning from function...");return!1}function Y(b,c){a.isArray(c.invalidReasons)?c.invalidReasons=a.map(c.invalidReasons,function(a){return a.invalidReason}):c.invalidReasons=[];var d=a.Event("invalidCertificate.cwic");d.info=c,d.respond=X,b.trigger(d)}function X(a,b){if(a&&typeof a=="string"&&typeof b=="boolean")be(!0,"handleInvalidCertificate sending response: "+b+" (for fingerprint - "+a),bk("handleInvalidCertificate",{certFingerprint:a,accept:b});else throw new TypeError("handleInvalidCert: Wrong arguments!")}function W(){}function V(a,b){be(!0,"SSO: CanCancel property changed. New state: "+b.cancancel),y.canCancel=b.cancancel}function U(a,b){be(!0,"SSO: Lifecycle session changed. New state: "+b)}function T(a,b){be(!0,"System lifecycle state changed. New state: "+b),w.signingOut&&b==="SIGNEDOUT"&&(w.signingOut=!1,bx(a,"eIdle")),b==="SIGNINGOUT"&&(w.signingOut=!0),b==="RESETTING"&&(w.emailReguiredCalled=!1)}function S(a){be(!0,"SSO: Show Window Triggered!")}function R(){be(!0,"SSO: Invoke Reset Data Triggered.")}function Q(){be(!0,"proceedWithDeviceSelection called"),bv(w.currState,w.authenticatedCallback)}function O(a,b){be(!0,"_triggerTelephonyDevicesChange called with following data: ",b),be(!0,"_triggerTelephonyDevicesChange: regGlobals: ",w),b.devices&&b.devices.length>0&&w.registeringPhone&&(w.telephonyDevicesSet=!0,be(!0,"Proceeding with device selection after waiting for TelephonyDevicesChange event."),Q())}function N(a){y.inProgress=!1,be(!0,"_triggerSignedIn called"),be(!0,"_triggerSignedIn: authenticatedCB present: ",w.authenticatedCallback?!0:!1),be(!0,"_triggerSignedIn: telephonyDevicesSet: ",w.telephonyDevicesSet),w.authenticatedCallback&&w.telephonyDevicesSet?(be(!0,"Proceeding with device selection immediately after SignedIn event"),Q()):be(!0,"_triggerSignedIn: Cannot proceed with device selection until devices are ready...");try{j.signedIn()}catch(b){be(!0,"No signedIn callback defined...")}}function M(a,b){if(!!w.registeringPhone){var c=b.error;y.inProgress=!1,L(a,c)}}function L(a,b){cb(a,w.errorCb,g.AuthenticationFailure,b,{registration:v}),z()}function K(a,b){w.errorState="emailRequired",localStorage&&localStorage.removeItem("_cwic_cache_email"),L(a,b)}function J(a,b,c){w.errorState="credentialsRequired",w.lastAuthenticatorId=c,L(a,b)}function I(a,b){function m(b,c){function g(d,f){if(d)return cb(a,j.error,i("NativePluginError"),d);c=f,bk("setUserProfileCredentials",{username:b,password:c,authenticator:e})}var f=!1;c&&c.encrypted&&(c=c.encrypted,f=!0);if(d.isNotValid(b,c))return I(a,{errors:["InvalidCredentials"],error:i("AuthenticationFailure"),authenticatorId:e});v.user=w.user=b,f===!1?t(c,g):bk("setUserProfileCredentials",{username:b,password:c,authenticator:e})}function l(a){if(c&&w.credentialsRequiredCalled)return J(a,c);w.credentialsRequiredCalled=!0;try{j.credentialsRequired(m,f)}catch(b){return cb(a,j.error,g.ServiceDiscoveryMissingOrInvalidCallback,b)}}function k(){return w.user?w.user:w.email&&typeof w.email=="string"?w.email.split("@")[0]:""}function h(a){if(w.user&&w.passphrase)return m(w.user,w.passphrase);J(a,i("AuthenticationFailure"),e);return}if(!!w.registeringPhone){var c=b.error,d=u.get("credentials"),e=b.authenticatorId,f="";if(w.manual){if(c){be(!0,"returning from credentialsRequired in manual mode, because of error..."),J(a,c,e);return}h(a)}else f=k(),l(a);return}}function H(a,b){function k(b){be(!0,"setEmailAddress: "+b);d.isNotValid(b)?H(a,{error:i("InvalidUserInput"),errors:["Invalid email submited"]}):(w.email=b,b!==e&&(v.email=b),localStorage?b!==e&&b!==localStorage.getItem("_cwic_cache_email")&&(be(!0,"saving email to localStorage"),localStorage.setItem("_cwic_cache_email",b)):be(!1,"localStorage not available, check IE mode the app is running in ..."),bk("setUserProfileEmailAddress",{email:b}))}if(!!w.registeringPhone){var c=b.error,d=u.get("email"),f="",h;if(w.manual){if(c){K(a,c);return}return k(e)}if(w.emailReguiredCalled){c||(c="ServiceDiscoveryFailure");return K(a,c)}w.emailReguiredCalled=!0;if(localStorage){h=localStorage.getItem("_cwic_cache_email");if(h){k(h);return}}else be(!0,"localStorage not available, check IE mode the app is running in ...");w.email&&typeof w.email=="string"&&w.email!==e?f=w.email:w.user&&typeof w.user=="string"&&(f=w.user+"@");try{j.emailRequired(k,f)}catch(l){return cb(a,j.error,g.ServiceDiscoveryMissingOrInvalidCallback,l)}}}function G(b,c){if(!j.redirectUri)return cb(b,y.args.error,g.SSOMissingOrInvalidRedirectURI);var d,e,f={},h=c.split("?"),i=h[0];be(!0,"Plugin sent URL: "+c);try{e=h[1].split("&"),a.each(e,function(a,b){var c=b.split("=");f[c[0]]=c[1]})}catch(k){be(!0,"Invalid SSO URL received",k);throw new Error("SSO authorization service URL invalid format")}f.client_id="C69908c4f345729af0a23cdfff1d255272de942193e7d39171ddd307bc488d7a1",f.redirect_uri=j.redirectUri,d=i+"?"+a.param(f),be(!0,"New URL generated: "+d);var l=a.Event("ssoNavigateTo.cwic");l.url=d,b.trigger(l)}function F(){function a(){}bk("resetData",{},a),localStorage&&(be(!0,"Removing data from localStorage..."),localStorage.removeItem("_cwic_cache_email"))}function E(){var a=this;y.canCancel?(y.canCancel=!1,bk("cancelSingleSignOn",{})):be(!1,"SSO(cancelSSO): Not possible to cancel SSO in the current state");return a}function D(b,c){function d(b,d){!b||b===w.lastConnectedDevice?be(!0,'authenticatedCb: device name empty or already sent "connect" message for this device, returning...',b):(d=d||"",w.lastConnectedDevice=b,bk("connect",{phoneMode:v.mode,deviceName:b,lineDN:d,forceRegistration:v.forceRegistration},a.noop,function(a){cb(c,w.errorCb,i(a),a,{registration:v})}))}return function(a){var c,e;be(!0,"Entering authenticatedCallback"),a.length===0&&be(!0,"authenticatedCallback: devices list of zero length received");if(b)try{b(a,v.mode,function(a,b,c){if(a==="SoftPhone"||!c)c="";be(!0,"connecting to user selected device: ",b),d(b,c)})}catch(f){be("Exception occurred in application devicesAvailable callback",f),typeof console!="undefined"&&console.trace&&console.trace()}else{c={name:""};for(e=0;e<a.length;e++){if(v.mode==="SoftPhone"&&a[e].isSoftPhone&&a[e].modelDescription.match(/^\s*Cisco\s+Unified\s+Client\s+Services\s+Framework\s*$/i)){c=a[e];break}if(v.mode==="DeskPhone"&&a[e].isDeskPhone){c=a[e];break}}be(!0,"connecting to discovered device: ",c),d(c.name)}}}function C(a,c){if(!b){cb(c,w.errorCb,g.PluginNotAvailable,"Plug-in is not available or has not been initialized",{registration:v});return!1}if(a.mode&&typeof a.mode=="string"&&!a.mode.match(/^(SoftPhone|DeskPhone)$/)){cb(c,w.errorCb,g.InvalidArguments,'Invalid phone mode "'+v.mode+'"',{registration:v});return!1}return!0}function B(b,c){var d=a.isFunction(b.devicesAvailable)?b.devicesAvailable:null;w.registeringPhone=!0,w.manual=!1,w.successCb=a.isFunction(b.success)?b.success:null,w.errorCb=a.isFunction(b.error)?b.error:null,w.CUCM="discovery based address",w.authenticatedCallback=D(d,c),v={mode:b.mode||"SoftPhone",devices:{},forceRegistration:b.forceRegistration||!1},be(!0,"setRegGlobalsD: regGlobals set: ",w),be(!0,"setRegGlobalsD: registration set: ",v)}function A(a){var b=this;a||(be(!0,"startDiscovery: empty arguments received"),a={}),be(!0,"startDiscovery called with arguments: ",a),B(a,b);if(C(a,b)===!1)return b;y.inProgress=!0,bk("startSignIn",{manualSettings:!1});return b}function z(){be(!0,"resetGlobals: reseting ...");var a=w.user||"",b=w.email||"",c=w.manual,d=w.unregisterCb||null,e=w.errorState||"",f=w.lastAuthenticatorId||null,g=w.lastAuthStatus||"";y={inProgress:!1,canCancel:!1},x.endTransfer(),w={registeringPhone:!1,manual:c,signingOut:!1,endingCallForId:-1,switchingMode:!1,telephonyDevicesSet:!1,lastConnectedDevice:"",lastAuthStatus:g,errorState:e,lastAuthenticatorId:f,successCb:null,errorCb:null,CUCM:[],user:a,password:"",email:b,unregisterCb:d,authenticatedCallback:null,credentialsRequiredCalled:!1,emailRequiredCalled:!1,ssoFailedCalled:!1},v={devices:{}}}function t(a,b){function c(a){a?b(null,a):b("Empty response from plugin")}a&&typeof a=="string"?bk("encryptCucmPassword",a,c):b("Invalid input string")}function s(){return navigator.platform&&navigator.platform.indexOf("Mac")!==-1}function r(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0}function p(a){return typeof a=="object"&&a!==null}function o(a){return function(){return!a.apply(this,[].slice.call(arguments))}}function n(b,c){if(!a.browser)be(!1,"*******************************************************************************************************"),be(!1,"*******************************************************************************************************"),be(!1,"Jabber Web SDK with this version of jQuery won't work on IE8! (for IE8 support, use jQuery < 1.9)"),be(!1,"*******************************************************************************************************"),be(!1,"*******************************************************************************************************");else if(a.browser.msie&&a.browser.version==="8.0")return b;var d=null;return function(){var a=arguments,e=this;d&&clearTimeout(d),d=setTimeout(function(){d=null,b.apply(e,a)},c)}}function m(a){var b=a,c=[].slice.call(arguments,1);return function(){return b.apply(this,c)}}function l(){j=k}"use strict";var b=null,c,d={videoObject:null,window:null,lastId:-1},e="jabbersdk@any.domain",f=21,g={Unknown:{code:"Unknown",message:"Unknown error"},PluginNotAvailable:{code:"PluginNotAvailable",message:"Plugin not available"},BrowserNotSupported:{code:"BrowserNotSupported",message:"Browser not supported"},InvalidArguments:{code:"InvalidArguments",message:"Invalid arguments"},InvalidState:{code:"InvalidState",message:"Invalid State"},NativePluginError:{code:"NativePluginError",message:"Native plugin error"},OperationNotSupported:{code:"OperationNotSupported",message:"Operation not supported"},InvalidTFTPServer:{code:"InvalidTFTPServer",message:"The configured TFTP server is incorrect"},InvalidCCMCIPServer:{code:"InvalidCCMCIPServer",message:"The configured CCMCIP server is incorrect"},InvalidCTIServer:{code:"InvalidCTIServer",message:"The configured CTI server is incorrect"},ReleaseMismatch:{code:"ReleaseMismatch",message:"Release mismatch"},NoDevicesFound:{code:"NoDevicesFound",message:"No devices found"},TooManyPluginInstances:{code:"TooManyPluginInstances",message:"Too many plug-in instances"},AuthenticationFailure:{code:"AuthenticationFailure",message:"Authentication failed"},SignInError:{code:"SignInError",message:"Sign-in Error"},CallControlError:{code:"CallControlError",message:"Call control error"},PhoneConfigGenError:{code:"PhoneConfigGenError",message:"Phone configuration error"},CreateCallError:{code:"CreateCallError",message:"Cannot create call"},NetworkError:{code:"NetworkError",message:"Network error"},VideoWindowError:{code:"VideoWindowError",message:"Video window error"},CapabilityMissing:{code:"CapabilityMissing",message:"Capability Missing"},NotUserAuthorized:{code:"NotUserAuthorized",message:"User did not authorize access"},OperationFailed:{code:"OperationFailed",message:"Operation Failed"},ExtensionNotAvailable:{code:"ExtensionNotAvailable",message:"Browser extension not available"},DockingCapabilitiesNotAvailable:{code:"DockingCapabilitiesNotAvailable",message:"External video docking capabilities not available"},DockArgumentNotHTMLElement:{code:"DockArgumentNotHTMLElement",message:"Dock needs to be called on an HTMLElement"},ServiceDiscoveryMissingOrInvalidCallback:{code:"ServiceDiscoveryMissingOrInvalidCallback",message:"Service Discovery Error - Callback not implemented or exception occured"},SSOMissingOrInvalidRedirectURI:{code:"SSOMissingOrInvalidRedirectURI",message:"Redirect URI missing or invalid"},InvalidUserInput:{code:"InvalidUserInput",message:"Invalid user input"},CertificateError:{code:"CertificateError",message:"Certificate error"},InvalidURLFragment:{code:"InvalidURLFragment",message:"Invalid URL fragment received"},ErrorReadingConfig:{code:"ErrorReadingConfig",message:"Error reading config"},UnexpectedLifecycleState:{code:"UnexpectedLifecycleState",message:"Unexpected application lifecycle state"},SSOStartSessionError:{code:"SSOStartSessionError",message:"SSO start session error"},SSOCanceled:{code:"SSOCanceled",message:"SSO canceled"},SSOInvalidUserSwitch:{code:"SSOInvalidUserSwitch",message:"Invalid user switch"},SSOSessionExpired:{code:"SSOSessionExpired",message:"SSO session expired"},ServiceDiscoveryFailure:{code:"ServiceDiscoveryFailure",message:"Cannot find services automatically"},CannotConnectToServer:{code:"CannotConnectToServer",message:"Cannot connect to CUCM server"},SelectDeviceFailure:{code:"SelectDeviceFailure",message:"Connecting to phone device failed"},NoError:{code:"NoError",message:"No error"}},h={eCreateCallFailed:"CreateCallError",eCallOperationFailed:"CallControlError",eNoActiveDevice:"PhoneConfigGenError",eLoggedInLock:"TooManyPluginInstances",eLogoutFailed:"SignInError",eNoWindowExists:"VideoWindowError",eInvalidWindowIdOrObject:"VideoWindowError",eWindowAlreadyExists:"VideoWindowError",eNoPhoneMode:"InvalidArgument",eInvalidArgument:"InvalidArguments",eOperationNotSupported:"OperationNotSupported",eCapabilityMissing:"CapabilityMissing",eNotUserAuthorized:"NotUserAuthorized",eSyntaxError:"NativePluginError",eOperationFailed:"OperationFailed",eInvalidCallId:"InvalidArguments",eInvalidState:"InvalidState",eNoError:"NoError",eUnknownServiceEvent:"Unknown",Ok:"NoError",Unknown:"Unknown",DeviceRegNoDevicesFound:"NoDevicesFound",NoCredentialsConfiguredServerHealth:"AuthenticationFailure",InvalidCredential:"AuthenticationFailure",InvalidCredentialServerHealth:"AuthenticationFailure",InvalidCCMCIPServer:"InvalidCCMCIPServer",InvalidTFTPServer:"InvalidTFTPServer",InvalidCTIServer:"InvalidCTIServer",NoNetwork:"NetworkError",TLSFailure:"NetworkError",SSLConnectError:"NetworkError",ServerConnectionFailure:"CannotConnectToServer",ServerAuthenticationFailure:"AuthenticationFailure",SelectDeviceFailure:"SelectDeviceFailure",InValidConfig:"AuthenticationFailure",ServerCertificateRejected:"CertificateError",InvalidToken:"AuthenticationFailure",InvalidAuthorisationTokenServerHealth:"AuthenticationFailure",ErrorReadingConfig:"ErrorReadingConfig",InvalidStartupHandlerState:"UnexpectedLifecycleState",InvalidLifeCycleState:"UnexpectedLifecycleState",InvalidCertRejected:"CertificateError",SSOPageLoadError:"UnexpectedLifecycleState",SSOStartSessionError:"SSOStartSessionError",SSOUnknownError:"UnexpectedLifecycleState",SSOCancelled:"SSOCancelled",SSOCertificateError:"CertificateError",SSOInvalidUserSwitch:"SSOInvalidUserSwitch",SSOWhoAmIFailure:"SSOStartSessionError",SSOSessionExpired:"SSOSessionExpired",ServiceDiscoveryFailure:"ServiceDiscoveryFailure",ServiceDiscoveryAuthenticationFailure:"AuthenticationFailure",ServiceDiscoveryCannotConnectToCucmServer:"CannotConnectToServer",ServiceDiscoveryNoCucmConfiguration:"ServiceDiscoveryFailure",ServiceDiscoveryNoSRVRecordsFound:"ServiceDiscoveryFailure",ServiceDiscoveryCannotConnectToEdge:"CannotConnectToServer",ServiceDiscoveryNoNetworkConnectivity:"NetworkError",ServiceDiscoveryUntrustedCertificate:"CertificateError"},i=function(a,b){var c="Unknown";h[a]?c=h[a]:g[a]?c=a:b&&h[b]?c=h[b]:b&&g[b]&&(c=b);return g[c]},j={ready:null,devicePrefix:"ecp",verbose:!0,log:function(a,b){typeof console!="undefined"&&console.log&&(console.log(a),b&&console.log(b))},error:function(a){be("Error: ",a)},errorMap:{},delayedUserAuth:null,serviceDiscovery:!0,redirectUri:"",emailRequired:function(a,b){be(!1,"emailRequired callback not implemented, cannot proceed with sign in");throw{name:g.ServiceDiscoveryMissingOrInvalidCallback.message,message:"emailRequired not implemented",toString:function(){return this.name+": "+this.message}}},credentialsRequired:function(a,b){be(!1,"credentialsRequired callback not implemented, cannot proceed with sign in");throw{name:g.ServiceDiscoveryMissingOrInvalidCallback.message,message:"credentialsRequired not implemented",toString:function(){return this.name+": "+this.message}}},signedIn:function(){be(!1,"default signedIn callback called...")}},k=a.extend({},j),q=o(p),u=function(){function i(a){return!0}function h(a,b){return!0}function g(a){return!0}function f(a){return!0}function e(a){return!0}function d(a){return!0}function c(a){return!0}var b;b={email:{validate:c,isValid:c,isNotValid:o(c)},ssourl:{validate:d,isValid:d,isNotValid:o(d)},credentials:{validate:h,isValid:h,isNotValid:o(h)},url:{validate:e,isValid:e,isNotValid:o(e)},passphrase:{validate:g,isValid:g,isNotValid:o(g)},username:{validate:f,isValid:f,isNotValid:o(f)},ssotoken:{validate:i,isValid:i,isNotValid:o(i)}};return{get:function(c){var d;if(typeof c!="string")throw new TypeError(d+" is not a string");d=b[a.trim(c)];if(d)return d;throw new Error(c+" is not defined")}}}(),v,w={},x={endTransfer:function(){this.inProgress=!1,this.completeBtn=null,this.callId=null}},y;z();var P=n(O,20),bb=!1,bf=function(){var a=!0;!b||!b.api?(be(!0,"_doesPluginExist failed basic existence check"),a=!1):typeof b.api.sendRequest=="undefined"&&typeof b.api.postMessage=="undefined"&&(be(!0,"_doesPluginExist failed sendRequest/postMessage method check"),a=!1);return a},bg=function(a,b,c){try{a._addListener?a._addListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}catch(d){be("_addListener error: ",d)}},bh=function(a,b,c){try{if(a._addListener)return;a.attachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}catch(d){be("_removeListener error: ",d)}},bi=function bi(c){var d=b?b.scope:this,e;if(c.ciscoChannelServerMessage)c.ciscoChannelServerMessage.name==="ChannelDisconnect"?(be("Extension channel disconnected",c.ciscoChannelServerMessage),b=null,bl.purge(),cb(d,j.error,g.ExtensionNotAvailable,"Lost connection to browser extension")):c.ciscoChannelServerMessage.name==="HostDisconnect"?(be("Host application disconnected",c.ciscoChannelServerMessage),b=null,bl.purge(),cb(d,j.error,g.PluginNotAvailable,"Lost connection to plugin")):be("ciscoChannelServerMessage unknown name: "+c.ciscoChannelServerMessage.name);else if(c.ciscoSDKServerMessage){var f=c.ciscoSDKServerMessage.content,h=c.ciscoSDKServerMessage.error,k=c.ciscoSDKServerMessage.replyToMessageId,l=c.ciscoSDKServerMessage.name;be(!0,"_handlePluginMessage: "+l,c.ciscoSDKServerMessage);if(f&&f.errors){f.errors=a.map(f.errors,function(a){return a.error!==""?a.error:null}),be(!0,"Lifecycle error list contains "+f.errors.length+" errors");for(e=0;e<f.errors.length;e++)be(!0,"Lifecycle error from the list",f.errors[e]);f.error=f.errors.length?i(f.errors[0]):null}f&&f.errors===""&&(be(!0,"Received empty string instead of lifecycle error list"),f.errors=[],f.error=null),k&&bl.callCallback(k,h,f);switch(l){case"init":_cwic_onInitReceived(f);break;case"userauthorized":_cwic_userAuthHandler(f);break;case"connectionstatuschange":bx(d,f);break;case"multimediacapabilitiesstarted":bd(d,!0);break;case"multimediacapabilitiesstopped":bd(d,!1);break;case"ringtonechanged":bc(d,f);break;case"attendedtransferstatechange":ba(d,f);break;case"multimediadevicechange":bb&&bk("getMultimediaDevices",function(a){bP(d,a)});break;case"connectionfailure":be(!0,"Connection Failure event received with reason: ",f);if(f==="None"){be(!1,'Received "None", returning...');return}var n=i(f,"ServerConnectionFailure");cb(d,w.errorCb,n,f,{registration:v});break;case"authenticationresult":bO(d,f);break;case"telephonydeviceschange":P(d,f);break;case"callstatechange":ca(d,f,"state");break;case"externalwindowevent":bQ(d,f),cE.isVideoBeingReceived=f.showing;break;case"videoresolutionchange":be(!0,"video resolution change detected for call "+f.callId+". Height: "+f.height+", width: "+f.width,f),ca(d,{callId:f.callId,videoResolution:{width:f.width,height:f.height}},"render");break;case"ssonavigateto":G(d,f);break;case"userprofilecredentialsrequired":I(d,f);break;case"ssosigninrequired":M(d,f);break;case"userprofileemailaddressrequired":H(d,f);break;case"loggedin":N(d);break;case"invokeresetdata":R(f);break;case"ssoshowwindow":S(f);break;case"ssosessionexpirypromptrequired":_triggerSSOSessionExpiryPromptRequired();break;case"lifecyclestatechanged":T(d,f);break;case"lifecyclessosessionchanged":U(d,f);break;case"cancancelsinglesignonchanged":V(d,f);break;case"invalidcertificate":Y(d,f);break;default:}}else be(!0,"Unknown msg from plugin: ",c)},bl={callbacks:[],callCallback:function(b,c,d){if(!!this.callbacks[b]){var e,f;c&&c!=="eNoError"?(e=this.callbacks[b].errorCb,f=c):(e=this.callbacks[b].successCb,f=d);if(a.isFunction(e)){be(!0,"clientRequestCallbacks calling result callback for msgId: "+b);try{e(f)}catch(g){be("Exception occurred in clientRequestCallbacks callback",g)}}delete this.callbacks[b]}},purge:function(){this.callbacks=[]}},bq={windowobjects:[],getWindowId:function(a){var b=a.window,c=this.windowobjects.indexOf(b);c===-1&&!a.readOnly&&(this.windowobjects.push(b),c=this.windowobjects.indexOf(b),this.callbacks[c]={});return c},callbacks:[],callCallback:function(a,b){function c(a,b,c){if(a.callbacks[b].hasOwnProperty(c)){var d=a.callbacks[b][c];if(!d.wascalled&&d.callback){try{d.callback(c)}catch(e){be("Exception occurred in application videoLoaded callback",e),typeof console!="undefined"&&console.trace&&console.trace()}d.wascalled=!0}}}var d=this.getWindowId({window:a,readOnly:!0}),e;if(b)c(this,d,b);else for(e in this.callbacks[d])this.callbacks[d].hasOwnProperty(e)&&c(this,d,e)}},br=!1;window._cwic_onVideoPluginLoaded=function(a,b){be("_cwic_onVideoPluginLoaded called");var c=b||window;br||bt({obj:a,methodName:"configure",success:function(){br=!0}}),bq.callCallback(c,a.loadid)},window._cwic_onPopupVideoPluginLoaded=function(a,b){be("_cwic_onPopupVideoPluginLoaded called"),_cwic_onVideoPluginLoaded(a,b)},window._cwic_onSSOTokenReceived=function(a){var b=a.url,c=u.get("ssotoken");if(c.isValid(b))bk("ssoNavigationCompleted",{result:200,url:b,document:""});else throw new Error(g.InvalidURLFragment.code)};var bG=1,cE={_about:null,hasDockingCapabilities:function(){return cE._about.capabilities.externalWindowDocking},isVideoBeingReceived:!1,isDocked:!1,timeOfPreviousDocking:0,minimalTimeBeforeChangingPosition:10,targetDiv:null,targetDivStyle:{"background-color":"magenta",width:"8px",height:"8px",position:"fixed","border-right":"8px solid black","z-index":"2147483647"},frame:window,element:null,position:{},move:function(){if(cE.isDocked){var b=(new Date).getTime()-cE.timeOfPreviousDocking,c=cE.updateOffsets(cE.element.getBoundingClientRect()),d=c.top===cE.position.top&&c.left===cE.position.left&&c.height===cE.position.height&&c.width===cE.position.width&&c.cropTop===cE.position.cropTop&&c.cropLeft===cE.position.cropLeft&&c.cropHeight===cE.position.cropHeight&&c.cropWidth===cE.position.cropWidth?!1:!0;d&&b>cE.minimalTimeBeforeChangingPosition&&(cE.timeOfPreviousDocking=(new Date).getTime(),a.extend(cE.position,c),cE.sendMessageToAddOn("dockUpdate",cE.position)),cE.frame.requestAnimationFrame(cE.move)}},updateOffsets:function(b){var c=cE.frame,d=a(c).height(),e=a(c).width(),g,h,i,j=a.extend({cropTop:0,cropLeft:0,cropBottom:0,cropRight:0,cropWidth:0,cropHeight:0},b),k=0,l=0,m=0,n=0,o=0,p=c.devicePixelRatio*a(cE.element).css("zoom"),q=0,r=0;if("ontouchstart"in window&&navigator.maxTouchPoints>1){var s=c.innerWidth,t=s-c.document.documentElement.clientWidth;cE.lastZoomFactor=cE.lastZoomFactor||1,t>0?s-=t:s-=f/cE.lastZoomFactor;var u=c.document.documentElement.clientWidth/s;p*=u,cE.lastZoomFactor=p;var v=a(c.document).width()-a(c).width(),w=a(c.document).height()-a(c).height();if(u>1.01){q=c.scrollX,r=c.scrollY;var x=w-r;x>=0?r=0:r=Math.abs(x);var y=v-q;y>=0?q=0:q=Math.abs(y),x>=0&&(cE.initPosY=j.top+c.scrollY),j.top>cE.initPosY-w&&x<0&&(j.top=cE.initPosY-w),y>=0&&(cE.initPosX=j.left+c.scrollX),j.left>cE.initPosX-v&&y<0&&(j.left=cE.initPosX-v)}}j.left-=q,j.top-=r,j.cropTop=j.top<0?Math.abs(j.top):0,j.cropLeft=j.left<0?Math.abs(j.left):0,j.cropBottom=Math.max(j.bottom-d,0),j.cropRight=Math.max(j.right-e,0);while(c!=c.top)g=c.frameElement.getBoundingClientRect(),h=a(c.parent).width(),i=a(c.parent).height(),c.frameElement.frameBorder!==""&&!parseInt(c.frameElement.frameBorder,10)?k=0:k=2,c.frameElement.style.borderTopWidth===""?l=k:l=parseInt(c.frameElement.style.borderTopWidth||0,10),n=parseInt(c.frameElement.style.paddingTop||0,10),g.top<0&&(j.top+j.cropTop<0?j.cropTop+=Math.abs(g.top):Math.abs(g.top)-(j.top+j.cropTop+l+n)>0&&(j.cropTop+=Math.abs(Math.abs(g.top)-(j.top+j.cropTop+l+n)))),g.top+l+n+j.top+j.height-j.cropBottom>i&&(j.cropBottom=g.top+l+n+j.top+j.height-i),j.top+=g.top+l+n,c.frameElement.style.borderLeftWidth===""?m=k:m=parseInt(c.frameElement.style.borderLeftWidth||0,10),o=parseInt(c.frameElement.style.paddingLeft||0,10),g.left<0&&(j.left+j.cropLeft<0?j.cropLeft+=Math.abs(g.left):Math.abs(g.left)-(j.left+j.cropLeft+m+o)>0&&(j.cropLeft+=Math.abs(Math.abs(g.left)-(j.left+j.cropLeft+m+o)))),g.left+m+o+j.left+j.width-j.cropRight>h&&(j.cropRight=g.left+m+o+j.left+j.width-h),j.left+=g.left+m+o,c=c.parent;j.cropHeight=Math.max(j.height-(j.cropTop+j.cropBottom),0),j.cropTop=j.height>j.cropTop?j.cropTop:0,j.cropWidth=Math.max(j.width-(j.cropLeft+j.cropRight),0),j.cropLeft=j.width>j.cropLeft?j.cropLeft:0,cE.isVideoBeingReceived&&j.cropHeight>8&&j.cropWidth>16&&cE._about.capabilities.showingDockingTarget?cE.setTarget(j):a(cE.targetDiv).css({display:"none"}),j.left=Math.round(p*j.left),j.top=Math.round(p*j.top),j.width=Math.ceil(p*j.width),j.height=Math.ceil(p*j.height),j.cropLeft=Math.round(p*j.cropLeft)||0,j.cropTop=Math.round(p*j.cropTop)||0,j.cropWidth=Math.floor(p*j.cropWidth)||0,j.cropHeight=Math.floor(p*j.cropHeight)||0,j.scaleCoefficient=p;return j},sendMessageToAddOn:function(b,c){var d={offsetX:c.left,offsetY:c.top,width:c.width,height:c.height,cropOffsetX:c.cropLeft,cropOffsetY:c.cropTop,cropWidth:c.cropWidth,cropHeight:c.cropHeight},e=c.scaleCoefficient;b==="dockExternalWindow"?d.title=cE.frame.top.document.title||cE.frame.top.location.host+cE.frame.top.location.pathname+cE.frame.top.location.search:(d.pageWidth=Math.floor(a(cE.frame.top).width()*e),d.pageHeight=Math.floor(a(cE.frame.top).height()*e)),bk(b,d)},resetPosition:function(){cE.targetDiv&&a(cE.targetDiv).css("display","none"),cE.position={},cE.timeOfPreviousDocking=0},setTarget:function(b){var c=b.top+b.cropTop>0||b.bottom<=8?Math.ceil(b.top+b.cropTop):0,d=b.left+b.cropLeft>0||b.right<=16?Math.ceil(b.left+b.cropLeft):0;cE.createTargetDivIfNeeded(),a(cE.targetDiv).css({display:"block",top:c,left:d})},createTargetDivIfNeeded:function(){cE.targetDiv||(cE.targetDiv=cE.frame.top.document.createElement("div"),cE.frame.top.document.body.appendChild(cE.targetDiv),a(cE.targetDiv).css(cE.targetDivStyle))}},cJ={about:bo,init:bz,shutdown:bN,rebootIfBroken:bm,registerPhone:bU,manualSignIn:bU,switchPhoneMode:bT,unregisterPhone:bZ,startConversation:cc,updateConversation:ce,endConversation:cd,createVideoWindow:bH,addPreviewWindow:bJ,removePreviewWindow:bK,sendDTMF:cf,getInstanceId:cg,getMultimediaDevices:ch,setRecordingDevice:ck,setPlayoutDevice:cs,setCaptureDevice:ct,setRingerDevice:cl,getUserAuthStatus:cH,showUserAuthorization:cI,showCallInExternalWindow:cu,hideExternalWindow:cx,showPreviewInExternalWindow:cv,setExternalWindowAlwaysOnTop:cy,setExternalWindowShowSelfViewPip:cz,setExternalWindowShowControls:cA,setExternalWindowTitle:cD,getExternalWindowState:cw,setExternalWindowSelfViewPipPosition:cC,dock:cF,undock:cG,startDiscovery:A,cancelSSO:E,resetData:F,signOut:b$,setSpeakerVolume:cm,setRingerVolume:cn,setMicrophoneVolume:co,setRingtone:cp,setPlayRingerOnAllDevices:cq,getMultimediaDeviceVolume:cr};a.fn.cwic=function(a){try{if(cJ[a])return cJ[a].apply(this,Array.prototype.slice.call(arguments,1));if(typeof a=="object"||!a)return cJ.init.apply(this,arguments);throw a+": no such method on jQuery.cwic"}catch(b){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&b.message&&console.log("Exception occured in $.fn.cwic() "+b.message)),cb(this,b)}}})(jQuery);
